{
  "name": "upstart",
  "scopeName": "source.upstart",
  "patterns": [
    { "include": "#comment" },
    { "include": "#exec" },
    { "include": "#script" },
    { "include": "#env" },
    { "include": "#export" },
    { "include": "#expect" },
    { "include": "#kill-reload-signal" },
    { "include": "#kill-timeout" },
    { "include": "#documentation" },
    { "include": "#emits" },
    { "include": "#event-definition" }
  ],
  "repository": {
    "comment": {
      "name": "comment.line.upstart",
      "begin": "#",
      "end": "$"
    },
    "script": {
      "begin": "\\bscript\\b",
      "end": "\\bend script\\b",
      "name": "storage.type.script.upstart",
      "contentName": "meta.embedded.block.shellscript",
      "patterns": [
        { "include": "source.shell" }
      ]
    },
    "exec": {
      "begin": "\\bexec\\b",
      "end": "(?<!\\\\)\\n",
      "name": "storage.type.exec.upstart",
      "contentName": "meta.embedded.block.shellscript",
      "patterns": [
        { "include": "source.shell" }
      ]
    },
    "env": {
      "match": "^env\\s+(\\w+)(?:(=)(.+))?$",
      "name": "keyword.other.env.upstart",
      "captures": {
        "1": { "name": "variable.upstart" },
        "2": { "name": "keyword.operator.equals.upstart" },
        "3": { "name": "string.upstart" }
      }
    },
    "export": {
      "match": "^export (\\w+)$",
      "name": "keyword.other.export.upstart",
      "captures": {
        "1": { "name": "variable.upstart"}
      }
    },
    "expect": {
      "match": "^expect (fork|daemon|stop)$",
      "name": "keyword.other.expect.upstart"
    },
    "signal-numeric": {
      "match": "\\b\\d+\\b",
      "name": "constant.numeric.signal.upstart"
    },
    "signal-name": {
      "match": "\\b(SIG)?(HUP|INT|QUIT|ILL|TRAP|ABRT|IOT|BUS|EMT|FPE|KILL|USR1|SEGV|USR2|PIPE|ALRM|TERM|STKFLT|CHLD|CLD|CONT|STOP|TSTP|TTIN|TTOU|URG|XCPU|XFSZ|VTALRM|PROF|WINCH|IO|POLL|PWR|INFO|LOST|SYS|UNUSED)\\b",
      "name": "constant.language.signal.upstart"
    },
    "kill-reload-signal": {
      "begin": "^(kill|reload) signal",
      "end": "$",
      "beginCaptures": {
        "0": { "name": "keyword.other.kill-reload.upstart" }
      },
      "patterns": [
        { "include": "#signal-numeric" },
        { "include": "#signal-name" }
      ]
    },
    "number": {
      "match": "\\b\\d+\\b",
      "name": "constant.numeric.upstart"
    },
    "kill-timeout": {
      "begin": "^kill timeout",
      "end": "$",
      "beginCaptures": {
        "0": { "name": "keyword.other.kill-timeout.upstart" }
      },
      "patterns": [
        { "include": "#number" }
      ]
    },
    "double-quoted-string": {
      "begin": "\"",
      "end": "\"",
      "name": "string.quoted.double.upstart"
    },
    "documentation": {
      "begin": "^(author|description|version|usage)",
      "end": "$",
      "beginCaptures": {
        "0": { "name": "keyword.other.documentation.upstart"}
      },
      "patterns":[
        { "include": "#double-quoted-string" }
      ]
    },
    "emits": {
      "begin": "^emits",
      "end": "$",
      "beginCaptures": {
        "0": { "name": "keyword.other.emits.upstart" }
      },
      "patterns": [
        {
          "comment": "No special treatment for wildcards (*,?), becuase there is no usage in platform2.",
          "match": "\\S+",
          "name": "string.unquoted.event.upstart"
        }
      ]
    },
    "event-definition": {
      "begin": "^(start|stop) on",
      "end": "$",
      "beginCaptures": {
        "0": { "name": "keyword.other.event-definition.upstart" }
      },
      "patterns":[
        {
          "match": "\\b(started|starting|stopped|stopping)\\b",
          "name": "keyword.operator.modifier.upstart"
        },
        {
          "match": "\\b(and|or)\\b",
          "name": "keyword.operator.logical.upstart"
        },
        {
          "match": "(\\w|-)+",
          "name": "entity.name.function.event.upstart"
        }
      ]
    }
  }
}
